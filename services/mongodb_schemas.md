# MongoDB Schemas - MVP Phase 1

## Database: `mathematricks_trading`

### Collection: `raw_signals`
Stores raw incoming signals from external providers (before standardization)
```json
{
  "_id": ObjectId,
  "timestamp": ISODate,
  "source": String,  // "tradingview", "custom_provider", etc.
  "raw_data": Object,  // Original payload as received
  "processed": Boolean,
  "created_at": ISODate
}
```

### Collection: `standardized_signals`
Stores signals in the internal "Mathematricks" format
```json
{
  "_id": ObjectId,
  "signal_id": String,  // Unique identifier
  "strategy_id": String,
  "timestamp": ISODate,
  "instrument": String,  // "SPX", "EURUSD", "GC", etc.
  "direction": String,  // "LONG", "SHORT"
  "action": String,  // "ENTRY", "EXIT"
  "order_type": String,  // "MARKET", "LIMIT", "STOP"
  "price": Number,
  "quantity": Number,
  "stop_loss": Number,
  "take_profit": Number,
  "expiry": ISODate,
  "metadata": {
    "expected_alpha": Number,  // For 30% slippage rule
    "backtest_data": Object
  },
  "processed_by_cerebro": Boolean,
  "created_at": ISODate
}
```

### Collection: `trading_orders`
Orders generated by CerebroService after position sizing
```json
{
  "_id": ObjectId,
  "order_id": String,
  "signal_id": String,
  "strategy_id": String,
  "account": String,  // "IBKR_Main", "Binance_Futures"
  "timestamp": ISODate,
  "instrument": String,
  "direction": String,
  "action": String,
  "order_type": String,
  "price": Number,
  "quantity": Number,  // Position-sized quantity
  "stop_loss": Number,
  "take_profit": Number,
  "expiry": ISODate,
  "cerebro_decision": {
    "allocated_capital": Number,
    "margin_required": Number,
    "position_size_logic": String,
    "risk_metrics": Object
  },
  "status": String,  // "PENDING", "SUBMITTED", "FILLED", "REJECTED", "CANCELLED"
  "created_at": ISODate
}
```

### Collection: `execution_confirmations`
Fills, partial fills, and rejections from brokers
```json
{
  "_id": ObjectId,
  "order_id": String,
  "execution_id": String,  // Broker's execution ID
  "timestamp": ISODate,
  "account": String,
  "instrument": String,
  "side": String,  // "BUY", "SELL"
  "quantity": Number,
  "price": Number,
  "commission": Number,
  "status": String,  // "FILLED", "PARTIAL_FILL", "REJECTED"
  "broker_response": Object,
  "created_at": ISODate
}
```

### Collection: `account_state`
Real-time account data from brokers
```json
{
  "_id": ObjectId,
  "account": String,
  "timestamp": ISODate,
  "equity": Number,
  "cash_balance": Number,
  "margin_used": Number,
  "margin_available": Number,
  "unrealized_pnl": Number,
  "realized_pnl": Number,
  "open_positions": [
    {
      "instrument": String,
      "quantity": Number,
      "entry_price": Number,
      "current_price": Number,
      "unrealized_pnl": Number,
      "margin_required": Number
    }
  ],
  "open_orders": [
    {
      "order_id": String,
      "instrument": String,
      "side": String,
      "quantity": Number,
      "order_type": String,
      "price": Number
    }
  ],
  "created_at": ISODate
}
```

### Collection: `cerebro_decisions`
Log of Cerebro's position sizing decisions
```json
{
  "_id": ObjectId,
  "signal_id": String,
  "decision": String,  // "APPROVED", "REJECTED", "MODIFIED"
  "timestamp": ISODate,
  "reason": String,
  "original_quantity": Number,
  "final_quantity": Number,
  "risk_assessment": {
    "portfolio_margin_before": Number,
    "portfolio_margin_after": Number,
    "margin_utilization_pct": Number,
    "cvar_contribution": Number,
    "correlation_impact": Object
  },
  "created_at": ISODate
}
```

## Database: `mathematricks_signals` (Existing)
Used by signal_collector.py - DO NOT MODIFY

### Collection: `trading_signals`
See signal_collector.py:350-359 for integration point
